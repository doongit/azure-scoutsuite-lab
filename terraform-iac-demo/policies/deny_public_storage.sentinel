import "tfplan/v2" as tfplan

main = rule {
  all tfplan.resource_changes as _, rc {
    allowed_storage_account(rc)
  }
}

allowed_storage_account = func(rc) {
  rc.type != "azurerm_storage_account" or
  (
    compliant_network(rc) and
    compliant_https(rc)
  )
}

compliant_network = func(rc) {
  not rc.change.after.public_network_access_enabled
}

compliant_https = func(rc) {
  rc.change.after.https_traffic_only_enabled
}
